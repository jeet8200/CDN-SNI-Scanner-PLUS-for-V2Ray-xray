<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VLESS Master: JeetHm & G Edition</title>
    <style>
        :root { --primary: #3b82f6; --secondary: #94a3b8; --success: #10b981; --danger: #ef4444; --bg: #0f172a; --card: #1e293b; --text: #f1f5f9; --border: #334155; --input-bg: #0f172a; }
        [data-theme="light"] { --primary: #2563eb; --secondary: #64748b; --success: #059669; --danger: #dc2626; --bg: #f8fafc; --card: #ffffff; --text: #1e293b; --border: #cbd5e1; --input-bg: #ffffff; }
        
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); padding: 20px 20px 80px 20px; line-height: 1.5; min-height: 100vh; transition: background 0.3s; }
        .container { max-width: 1100px; margin: 0 auto; background: var(--card); padding: 30px; border-radius: 12px; border: 1px solid var(--border); box-shadow: 0 10px 15px rgba(0,0,0,0.3); }
        .header-flex { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--border); padding-bottom: 10px; margin-bottom: 20px; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .path-row { grid-column: 1 / -1; display: flex; flex-direction: column; margin-bottom: 20px; }
        
        .field { display: flex; flex-direction: column; }
        label { font-size: 0.75rem; font-weight: 700; margin-bottom: 4px; color: var(--secondary); text-transform: uppercase; }
        
        input, select, textarea { padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 0.95rem; background: var(--input-bg); color: var(--text); width: 100%; box-sizing: border-box; }
        textarea { height: 100px; resize: vertical; }
        
        #path { flex: 1; font-family: 'Consolas', monospace; font-size: 0.85rem; }
        
        button { cursor: pointer; border: none; padding: 10px; border-radius: 8px; font-weight: 600; transition: 0.2s; opacity: 0.9; }
        button:hover { opacity: 1; transform: translateY(-1px); }
        
        .btn-main { background: var(--primary); color: white; width: 100%; margin-top: 10px; }
        .btn-reset { background: var(--danger); color: white; font-size: 0.75rem; padding: 8px; }
        .section-header { font-weight: bold; margin: 25px 0 10px; font-size: 0.85rem; color: var(--primary); border-bottom: 2px solid var(--border); }
        
        .output-textarea { margin-top: 15px; background: #000; color: #38bdf8; padding: 15px; border-radius: 8px; font-family: 'Consolas', monospace; font-size: 0.8rem; height: 250px; border: 1px solid var(--primary); }
        .footer-credits { position: fixed; bottom: 20px; left: 0; width: 100%; text-align: center; font-size: 0.9rem; color: var(--secondary); font-weight: 600; pointer-events: none; }
        .ping-item { display: flex; justify-content: space-between; border-bottom: 1px solid var(--border); padding: 4px 0; font-size: 0.8rem; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-flex">
        <h2 style="color:var(--primary); margin:0;">VLESS Master Bulk</h2>
        <button id="themeBtn" onclick="toggleTheme()" style="background:var(--primary); color:white; border-radius:20px; padding:5px 15px;">Light Mode</button>
    </div>

    <div class="field">
        <label>1. Initial VLESS Link</label>
        <textarea id="rawInput" placeholder="Paste link here..."></textarea>
        <button class="btn-main" onclick="parseBase()">Analyze & Edit</button>
    </div>

    <div id="editor" style="display:none;">
        <div class="section-header">Core Config & Billing</div>
        <div class="grid">
            <div class="field">
                <label>UUID</label>
                <input type="text" id="uuid" oninput="liveUpdate()">
            </div>
            <div class="field">
                <label>Prefix (Emoji/Text)</label>
                <div style="display:flex; gap:5px;">
                    <input type="text" id="prefix" placeholder="Type or Select" oninput="liveUpdate()">
                    <select style="width:100px;" onchange="document.getElementById('prefix').value = this.value; liveUpdate();">
                        <option value="">None</option>
                        <option value="üöÄ">üöÄ Fast</option>
                        <option value="üíé">üíé VIP</option>
                        <option value="‚ö°">‚ö° Speed</option>
                        <option value="üõ°Ô∏è">üõ°Ô∏è Secure</option>
                        <option value="üî•">üî• Hot</option>
                        <option value="üåç">üåç Global</option>
                    </select>
                </div>
            </div>
            <div class="field">
                <label>Alias (Remark)</label>
                <input type="text" id="remark" oninput="liveUpdate()">
            </div>
            <div class="field">
                <label>Billing (Num)</label>
                <input type="number" id="totalNumeric" oninput="updateWords(this.value); liveUpdate();">
                <div id="wordsDisplay" style="font-size:0.7rem; color:var(--primary); font-style:italic; margin-top:3px;"></div>
            </div>
        </div>

        <div class="section-header">Connection Details</div>
        <div class="grid">
            <div class="field">
                <label>Port</label>
                <input type="number" id="port" oninput="handlePortChange(this.value); liveUpdate();">
            </div>
            <div class="field">
                <label>Security</label>
                <select id="security" onchange="toggleTlsUI(); liveUpdate();">
                    <option value="tls">TLS</option>
                    <option value="reality">REALITY</option>
                    <option value="none">None</option>
                </select>
            </div>
            <div class="field">
                <label>Transport</label>
                <input type="text" id="type" value="ws" oninput="liveUpdate()">
            </div>
        </div>

        <div class="path-row">
            <label>Path (Add Bypass Preset)</label>
            <div style="display:flex; gap:10px; align-items:center;">
                <input type="text" id="path" placeholder="/" oninput="liveUpdate()">
                <select style="width:250px;" id="pathPreset" onchange="applyPathPreset(this.value); liveUpdate();">
                    <option value="">-- Choose Bypass Type --</option>
                    <option value="?ed=2560">?ed=2560 [Speed: Early Data]</option>
                    <option value="?ed=2560&browser=chrome">?ed+Chrome [Bypass: Fingerprint]</option>
                    <option value="/api/v1/update">/api/v1/update [Mask: System Update]</option>
                    <option value="/video/stream?buffer=true">/video/stream [Usage: Heavy Traffic]</option>
                    <option value="/graphql">/graphql [Mask: API Request]</option>
                    <option value="/chat/stream">/chat/stream [Mask: AI Chat]</option>
                </select>
            </div>
        </div>

        <div id="tlsUI" class="grid">
            <div class="field">
                <label>SNI</label>
                <input type="text" id="sni" oninput="liveUpdate()">
            </div>
            <div class="field">
                <label>Fingerprint (FP)</label>
                <select id="fp" onchange="liveUpdate()">
                    <option value="chrome">Chrome</option>
                    <option value="firefox">Firefox</option>
                    <option value="safari">Safari</option>
                    <option value="edge">Edge</option>
                    <option value="360">360</option>
                    <option value="qq">QQ</option>
                    <option value="random">Random</option>
                </select>
            </div>
            <div class="field">
                <label>ALPN</label>
                <select id="alpn" onchange="liveUpdate()">
                    <option value="h3,h2,http/1.1">h3, h2, http/1.1</option>
                    <option value="h2,http/1.1">h2, http/1.1</option>
                    <option value="h3">h3 Only</option>
                    <option value="h2">h2 Only</option>
                    <option value="http/1.1">http/1.1 Only</option>
                    <option value="h3,h2">h3, h2</option>
                    <option value="">Auto</option>
                </select>
            </div>
            <div class="field">
                <label>Host</label>
                <input type="text" id="host" oninput="liveUpdate()">
            </div>
        </div>

        <div class="section-header">2. IP Source</div>
        <div class="grid">
            <button onclick="loadCDN('cf'); liveUpdate();" style="background:#f97316; color:white;">CF IPs</button>
            <button onclick="loadCDN('gcore'); liveUpdate();" style="background:#6366f1; color:white;">Gcore IPs</button>
            <button onclick="cleanIPList(); liveUpdate();" style="background:#0ea5e9; color:white;">Clean IPs</button>
            <button onclick="clearAllData()" class="btn-reset">Reset</button>
        </div>
        <textarea id="ipList" placeholder="Paste IPs..." oninput="liveUpdate()"></textarea>
        
        <div class="grid" style="margin-top:10px;">
            <button onclick="runPingTest()" style="background:#7c3aed; color:white;">‚ö° Ping Test</button>
            <div class="field">
                <label>Max Ping</label>
                <input type="number" id="pingLimit" value="2000" oninput="liveUpdate()">
            </div>
        </div>
        <div id="pingLog" style="display:none; max-height:150px; overflow-y:auto; background:rgba(0,0,0,0.1); padding:10px; border-radius:8px;"></div>

        <div class="section-header">3. Export</div>
        <div style="margin-bottom:15px; display:flex; gap:20px;">
            <label><input type="radio" name="outMode" value="raw" checked onchange="refreshView()"> v2rayN</label>
            <label><input type="radio" name="outMode" value="b64" onchange="refreshView()"> Base64</label>
        </div>
        <button class="btn-main" style="background:var(--success);" onclick="generateNodes()">Generate Nodes</button>
    </div>

    <div id="resultArea" style="display:none;">
        <textarea id="finalOutput" class="output-textarea" readonly></textarea>
        <div class="grid" style="margin-top:15px;">
            <button class="btn-main" onclick="copyResult()">Copy All</button>
            <button class="btn-main" onclick="saveFile()" style="background:#475569;">Save .txt</button>
        </div>
    </div>
</div>

<div class="footer-credits">Created by JeetHm & G</div>

<script>
    const ipReg = /\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b/g;
    let store = { links: [], pings: {} };
    let hasGeneratedOnce = false;

    function liveUpdate() {
        if (hasGeneratedOnce) {
            generateNodes();
        }
    }

    function toggleTheme() {
        const b = document.body;
        const btn = document.getElementById('themeBtn');
        if (b.hasAttribute('data-theme')) {
            b.removeAttribute('data-theme');
            btn.innerText = "Light Mode";
        } else {
            b.setAttribute('data-theme', 'light');
            btn.innerText = "Dark Mode";
        }
    }

    function applyPathPreset(val) {
        if (!val) return;
        const pathInput = document.getElementById('path');
        let current = pathInput.value.trim();
        let actualVal = val.split(' [')[0];
        
        if (current === "" || current === "/") {
            pathInput.value = actualVal;
        } else {
            if (actualVal.startsWith('?') && current.includes('?')) {
                pathInput.value = current + actualVal.replace('?', '&');
            } else {
                pathInput.value = current + actualVal;
            }
        }
        document.getElementById('pathPreset').selectedIndex = 0;
    }

    function handlePortChange(v) {
        const sec = document.getElementById('security');
        if (["80", "8080", "8880"].includes(v)) {
            sec.value = "none";
        } else if (sec.value === "none") {
            sec.value = "tls";
        }
        toggleTlsUI();
    }

    function toggleTlsUI() {
        const sec = document.getElementById('security').value;
        document.getElementById('tlsUI').style.display = (sec === 'none') ? 'none' : 'grid';
    }

    function parseBase() {
        const raw = document.getElementById('rawInput').value.trim();
        try {
            const parts = raw.split('#');
            const url = new URL(parts[0]);
            const p = new URLSearchParams(url.search);
            document.getElementById('uuid').value = url.username;
            document.getElementById('port').value = url.port;
            document.getElementById('remark').value = parts[1] ? decodeURIComponent(parts[1]) : "Node";
            ['security', 'type', 'sni', 'host', 'fp', 'alpn'].forEach(k => { 
                if(p.has(k)) document.getElementById(k).value = p.get(k); 
            });
            if(p.has('path')) document.getElementById('path').value = decodeURIComponent(p.get('path'));
            document.getElementById('editor').style.display = 'block';
            toggleTlsUI();
        } catch(e) { 
            alert("Invalid Link"); 
        }
    }

    async function runPingTest() {
        const ips = cleanIPList();
        if(!ips.length) return alert("Paste IPs!");
        const log = document.getElementById('pingLog');
        log.style.display = 'block'; 
        log.innerHTML = "<b>Testing...</b>";
        store.pings = {};
        for(let ip of ips) {
            const start = Date.now();
            const ms = await new Promise(r => {
                const img = new Image();
                img.onload = img.onerror = () => r(Date.now() - start);
                setTimeout(() => r(9999), 2000);
                img.src = `https://${ip}/favicon.ico?t=${start}`;
            });
            store.pings[ip] = ms;
            const color = ms === 9999 ? '#ef4444' : (ms < 500 ? '#10b981' : '#f59e0b');
            log.innerHTML += `<div class="ping-item"><span>${ip}</span><span style="color:${color}">${ms === 9999 ? 'Timeout' : ms+'ms'}</span></div>`;
        }
        if(hasGeneratedOnce) generateNodes();
    }

    function generateNodes() {
        const ips = cleanIPList();
        const limit = parseInt(document.getElementById('pingLimit').value) || 9999;
        const bVal = document.getElementById('totalNumeric').value;
        const bWord = bVal ? numberToWords(bVal).replace(/\s/g, '_') : "O";
        const pre = document.getElementById('prefix').value.trim();
        
        store.links = [];
        let count = 1;

        ips.forEach(ip => {
            const lat = store.pings[ip] || 0;
            if (lat <= limit) {
                const params = new URLSearchParams();
                const sec = document.getElementById('security').value;
                params.set('security', sec);
                params.set('type', document.getElementById('type').value);
                if (sec !== 'none') {
                    ['sni', 'fp', 'alpn', 'host'].forEach(k => {
                        const v = document.getElementById(k).value;
                        if(v) params.set(k, v);
                    });
                }
                const path = document.getElementById('path').value;
                if(path) params.set('path', path);
                
                let finalAlias = `${document.getElementById('remark').value}_${bWord}_${count++}`;
                if(pre) finalAlias = `${pre}_${finalAlias}`;
                
                store.links.push(`vless://${document.getElementById('uuid').value}@${ip}:${document.getElementById('port').value}?${params.toString()}#${finalAlias}`);
            }
        });
        document.getElementById('resultArea').style.display = 'block';
        hasGeneratedOnce = true;
        refreshView();
    }

    function refreshView() {
        const mode = document.querySelector('input[name="outMode"]:checked').value;
        const out = document.getElementById('finalOutput');
        if(mode === 'b64') {
            out.value = btoa(store.links.join('\n'));
        } else {
            out.value = store.links.join('\n');
        }
    }

    function cleanIPList() {
        const val = document.getElementById('ipList').value;
        const found = val.match(ipReg);
        const unique = found ? [...new Set(found)] : [];
        return unique;
    }

    function numberToWords(num) {
        if (!num || isNaN(num) || num == 0) return "Zero";
        const a = ['', 'one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight', 'nine', 'ten', 'eleven', 'twelve', 'thirteen', 'fourteen', 'fifteen', 'sixteen', 'seventeen', 'eighteen', 'nineteen'];
        const b = ['', '', 'twenty', 'thirty', 'forty', 'fifty', 'sixty', 'seventy', 'eighty', 'ninety'];
        let n = ('000000000' + num).substr(-9).match(/^(\d{2})(\d{2})(\d{2})(\d{1})(\d{2})$/);
        if (!n) return ''; 
        let str = (n[1]!=0?(a[Number(n[1])]||b[n[1][0]]+' '+a[n[1][1]])+'crore ':'') + (n[3]!=0?(a[Number(n[3])]||b[n[3][0]]+' '+a[n[3][1]])+'thousand ':'') + (n[4]!=0?(a[Number(n[4])]||b[n[4][0]]+' '+a[n[4][1]])+'hundred ':'') + (n[5]!=0?((str!='')?'and ':'')+(a[Number(n[5])]||b[n[5][0]]+' '+a[n[5][1]]):'');
        return str.trim();
    }

    function updateWords(v) { document.getElementById('wordsDisplay').innerText = v ? numberToWords(v) : ""; }
    function loadCDN(t) { 
        const c = { cf: ["104.16.0.1", "172.67.0.1"], gcore: ["92.38.186.1", "5.188.36.1"] }; 
        document.getElementById('ipList').value = c[t].join('\n'); 
    }
    function copyResult() { const o = document.getElementById('finalOutput'); o.select(); document.execCommand('copy'); alert("Copied!"); }
    function saveFile() { 
        const b = new Blob([document.getElementById('finalOutput').value], {type:'text/plain'}); 
        const a = document.createElement('a'); a.href = URL.createObjectURL(b); a.download = "vless_export.txt"; a.click(); 
    }
    function clearAllData() { if(confirm("Reset everything?")) location.reload(); }
</script>
</body>
</html>
